{
  "type": "object",
  "properties": {
    "context": {
      "type": "object",
      "properties": {
        "domain": { "type": "string", "const": "nic2004:60232" },
        "country": { "type": "string" },
        "city": {
          "type": "string"
        },
        "action": { "type": "string", "const": "update" },
        "core_version": { "type": "string", "const": "1.2.0" },
        "bap_id": { "type": "string" },
        "bap_uri": { "type": "string" },
        "bpp_id": { "type": "string" },
        "bpp_uri": { "type": "string" },
        "transaction_id": {
          "type": "string",

          "errorMessage": "Transaction ID should be same across the transaction: ${/search/0/context/transaction_id}"
        },
        "message_id": {
          "type": "string"
        },
        "timestamp": { "type": "string", "format": "date-time" },
        "ttl": { "type": "string", "const": "PT30S" }
      },
      "required": [
        "domain",
        "country",
        "city",
        "action",
        "core_version",
        "bap_id",
        "bap_uri",
        "bpp_id",
        "bpp_uri",
        "transaction_id",
        "message_id",
        "timestamp",
        "ttl"
      ]
    },
    "message": {
      "type": "object",
      "properties": {
        "update_target": { "type": "string", "const": "fulfillment" },
        "order": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string"
            },
            "items": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "category_id": {
                    "type": "string"
             
                  },
                  "descriptor": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "string"
                      }
                    },
                    "required": ["code"]
                  }
                },
                "required": ["id", "category_id", "descriptor"]
              }
            },
            "fulfillments": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "type": { "type": "string" },
                  "@ondc/org/awb_no": { "type": "string" },
                  "start": {
                    "type": "object",
                    "properties": {
                      "instructions": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string",
                            "enum": ["1", "2", "3", "4"]
                          },
                          "name": { "type": "string" },
                          "short_desc": {
                            "type": "string"
                          },
                          "long_desc": { "type": "string" }
                        },
                        "required": ["code", "short_desc"],
                        "allOf": [
                          {
                            "if": {
                              "properties": { "code": { "const": "1" } }
                            },
                            "then": {
                              "properties": {
                                "short_desc": {
                                  "minLength": 10,
                                  "maxLength": 10,
                                  "pattern": "^[0-9]{10}$",
                                  "errorMessage": "should be a 10 digit number"
                                }
                              }
                            }
                          },
                          {
                            "if": {
                              "properties": {
                                "code": { "enum": ["2", "3", "4"] }
                              }
                            },
                            "then": {
                              "properties": {
                                "short_desc": {
                                  "maxLength": 6,
                                  "pattern": "^[a-zA-Z0-9]{1,6}$",
                                  "errorMessage": "should not be an empty string or have more than 6 digits"
                                }
                              }
                            }
                          }
                        ]
                      }
                    },
                    "additionalProperties": false
                  },
                  "end": {
                    "type": "object",
                    "properties": {
                      "instructions": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string",
                            "enum": ["1", "2", "3"]
                          },
                          "name": { "type": "string" },
                          "short_desc": {
                            "type": "string",
                            
                            "errorMessage": "cannot be same as PCC - ${3/start/instructions/short_desc}"
                          },
                          "long_desc": { "type": "string" }
                        },
                        "required": ["code"],
                        "allOf": [
                          {
                            "if": {
                              "properties": { "code": { "const": "3" } }
                            },
                            "then": {
                              "properties": {
                                "short_desc": {
                                  "maxLength": 0,
                                  "errorMessage": "is not required"
                                }
                              }
                            }
                          },
                          {
                            "if": {
                              "properties": { "code": { "enum": ["1", "2"] } }
                            },
                            "then": {
                              "properties": {
                                "short_desc": {
                                  "maxLength": 6,
                                  "pattern": "^[a-zA-Z0-9]{1,6}$",
                                  "errorMessage": "should not be an empty string or have more than 6 digits"
                                }
                              },
                              "required": ["short_desc"]
                            }
                          }
                        ]
                      }
                    },
                    "additionalProperties": false
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "code": { "type": "string", "enum": ["state"] },
                        "list": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "code": {
                                "type": "string",
                                "enum": ["ready_to_ship"]
                              },
                              "value": {
                                "type": "string",
                                "enum": ["yes", "no"]
                              }
                            },
                            "required": ["code", "value"]
                          }
                        }
                      },
                      "required": ["code", "list"]
                    }
                  }
                },
                "additionalProperties": false,
                "required": ["id", "type", "tags"]
              }
            },
            "@ondc/org/linked_order": {
              "type": "object",
              "properties": {
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "category_id": {
                        "type": "string",
                        "enum": [
                          "Grocery",
                          "F&B",
                          "Fashion",
                          "BPC",
                          "Electronics",
                          "Home & Kitchen",
                          "Pharma",
                          "Agriculture",
                          "Mobility"
                        ]
                      },
                      "descriptor": {
                        "type": "object",
                        "properties": { "name": { "type": "string" } },
                        "required": ["name"]
                      },
                      "quantity": {
                        "type": "object",
                        "properties": {
                          "count": { "type": "integer" },
                          "measure": {
                            "type": "object",
                            "properties": {
                              "unit": {
                                "type": "string",
                                "enum": [
                                  "unit",
                                  "dozen",
                                  "gram",
                                  "kilogram",
                                  "tonne",
                                  "litre",
                                  "millilitre"
                                ]
                              },
                              "value": { "type": "number" }
                            },
                            "required": ["unit", "value"]
                          }
                        },
                        "required": ["count", "measure"]
                      },
                      "price": {
                        "type": "object",
                        "properties": {
                          "currency": { "type": "string" },
                          "value": { "type": "string" }
                        },
                        "required": ["currency", "value"]
                      }
                    },
                    "required": [
                      "category_id",
                      "descriptor",
                      "quantity",
                      "price"
                    ]
                  }
                },
                "order": {
                  "type": "object",
                  "properties": {
                    "id": { "type": "string" },
                    "weight": {
                      "type": "object",
                      "properties": {
                        "unit": {
                          "type": "string",
                          "enum": [
                            "unit",
                            "dozen",
                            "gram",
                            "kilogram",
                            "tonne",
                            "litre",
                            "millilitre"
                          ]
                        },
                        "value": { "type": "number" }
                      },
                      "required": ["unit", "value"]
                    },
                    "dimensions": {
                      "type": "object",
                      "properties": {
                        "length": {
                          "type": "object",
                          "properties": {
                            "unit": {
                              "type": "string",
                              "enum": ["centimeter", "meter"]
                            },
                            "value": { "type": "number" }
                          },
                          "required": ["unit", "value"]
                        },
                        "breadth": {
                          "type": "object",
                          "properties": {
                            "unit": {
                              "type": "string",
                              "enum": ["centimeter", "meter"]
                            },
                            "value": { "type": "number" }
                          },
                          "required": ["unit", "value"]
                        },
                        "height": {
                          "type": "object",
                          "properties": {
                            "unit": {
                              "type": "string",
                              "enum": ["centimeter", "meter"]
                            },
                            "value": { "type": "number" }
                          },
                          "required": ["unit", "value"]
                        }
                      },
                      "required": ["length", "breadth", "height"]
                    }
                  },
                  "required": ["id", "weight"]
                }
              },
              "required": ["items", "order"]
            },
            "updated_at": { "type": "string", "format": "date-time" }
          },
          "additionalProperties": false,
          "required": ["id", "items", "fulfillments", "updated_at"]
        }
      },
      "required": ["update_target", "order"]
    }
  },
  "required": ["context", "message"]
}
